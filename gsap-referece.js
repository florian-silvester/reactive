// This file was generated by Slater.app - Exhibitions.js

// Back link
const backLinks = document.querySelectorAll('.nav_back_link');
backLinks.forEach(link => {
  link.addEventListener('click', event => {
    event.preventDefault();
    window.history.back();
  });
});

// Select the necessary elements
const container = document.querySelector('.show_inner');
const showItems = document.querySelectorAll('.show_item');
const images = document.querySelectorAll('.show_img');
const toggleButton = document.querySelector('.nav_toggle'); // Updated selector

let isGridView = false;

// Function to reset transformations
function resetTransformations() {
  showItems.forEach(item => {
    gsap.set(item, { clearProps: "all" });
  });
}

// Function to show Grid View
function showGridView() {
  console.log("Switching to Grid View");

  gsap.to(showItems, {
    scale: 0.9,
    opacity: 0,
    duration: 0.5,
    ease: "power2.inOut",
    onComplete: () => {
      window.scrollTo(0, 0);

      // Switch container classes for grid view
      container.classList.remove('u-vflex-center-top');
      container.classList.add('u-grid-custom');

      // Add the .is-shrunk class to all .show_img elements
      images.forEach(image => {
        image.classList.add('is-shrunk');
      });

      // Update the classes for each show item
      showItems.forEach(item => {
        item.classList.remove('u-vflex-center-center');
        item.classList.add('u-vflex-left-top');
      });

      // Reset any transforms set by previous animations
      resetTransformations();

      // Stagger in the .show_item elements
      gsap.set(showItems, { opacity: 0, y: 30 });
      gsap.to(showItems, {
        opacity: 1,
        y: 0,
        duration: 0.8,
        ease: "power2.out",
        stagger: 0.1,
      });
    }
  });

  isGridView = true;
}

// Function to show Full-Screen View
function showFullScreenView(clickedItem) {
  console.log("Switching to Full-Screen Flexbox View");

  gsap.to(showItems, {
    scale: 0.9,
    opacity: 0,
    duration: 0.5,
    ease: "power2.inOut",
    onComplete: () => {
      // Switch container classes for full-screen view
      container.classList.remove('u-grid-custom');
      container.classList.add('u-vflex-center-top');

      // Remove the .is-shrunk class from all .show_img elements
      images.forEach(image => {
        image.classList.remove('is-shrunk');
      });

      // Update the classes for each show item
      showItems.forEach(item => {
        item.classList.remove('u-vflex-left-top');
        item.classList.add('u-vflex-center-center');
      });

      // Reset any transforms set by previous animations
      resetTransformations();

      // If a specific item was clicked, scroll to it and animate
      if (clickedItem) {
        clickedItem.scrollIntoView({ behavior: 'auto', block: 'center' });

        gsap.fromTo(clickedItem, { opacity: 0, scale: 0.8 }, {
          opacity: 1,
          scale: 1,
          duration: 0.8,
          ease: "power2.out"
        });
      }
    }
  });

  isGridView = false;
}

// Toggle Button Click Event
toggleButton.addEventListener('click', function () {
  console.log("Toggle Button Clicked");
  if (isGridView) {
    showFullScreenView();
  } else {
    showGridView();
  }
});

// Image Click Event
images.forEach(image => {
  image.addEventListener('click', function (event) {
    console.log("Image Clicked");
    const clickedItem = image.closest('.show_item');
    if (isGridView) {
      // Open the clicked item in a fullscreen view
      showFullScreenView(clickedItem);
    } else {
      // Determine the index of the clicked show_item
      const index = Array.from(showItems).indexOf(clickedItem);
      if (index < showItems.length - 1) {
        // Scroll to the next show_item
        const nextItem = showItems[index + 1];
        gsap.to(window, {
          duration: 1,
          scrollTo: { y: nextItem },
          ease: "expo.out"
        });
      } else {
        // Last show_item was clicked; scroll to the .press_wrap section
        const pressWrap = document.querySelector('.press_wrap');
        if (pressWrap) {
          gsap.to(window, {
            duration: 1,
            scrollTo: { y: pressWrap },
            ease: "expo.out"
          });
        }
      }
    }
  });
});

// Animate the first image on load
const firstImage = document.querySelector('.show_item:first-child .show_img');
gsap.set(firstImage, { opacity: 0, y: 50 });
gsap.to(firstImage, { opacity: 1, y: 0, duration: 0.8, ease: "power2.out", delay: 0.2 });

// Removed Intersection Observer logic because captions are no longer used.

//--Work-modal--//
// For each works_item, add a click event that opens its modal.
document.querySelectorAll('.works_item').forEach(item => {
  item.addEventListener('click', function () {
    const modal = item.querySelector('.works_modal');
    if (modal && modal.classList.contains('closed')) {
      openModal(modal);
    }
  });
});

// Function to open the modal with a GSAP animation.
// For each works_item, add a click event that opens its modal.
document.querySelectorAll('.works_item').forEach(item => {
  item.addEventListener('click', function () {
    const modal = item.querySelector('.works_modal');
    if (modal && modal.classList.contains('closed')) {
      openModal(modal);
    }
  });
});

// Function to open the modal with a GSAP animation.
function openModal(modal) {
  // Disable page scroll
  document.body.style.overflow = 'hidden';

  // Switch the class from closed to open
  modal.classList.remove('closed');
  modal.classList.add('open');

  // Animate the modal in (from opacity 0 and a bit smaller scale)
  gsap.fromTo(
    modal, { opacity: 0, scale: 0.8 }, { opacity: 1, scale: 1, duration: 0.5, ease: "power2.out" }
  );

  // Add a click listener to the modal to allow it to be closed.
  modal.addEventListener('click', closeModal);
}

// Function to close the modal with a GSAP animation.
function closeModal(e) {
  // 'this' or e.currentTarget is the modal that was clicked.
  const modal = e.currentTarget;

  // Animate the modal out
  gsap.to(modal, {
    opacity: 0,
    scale: 0.8,
    duration: 0.5,
    ease: "power2.in",
    onComplete: function () {
      // Once the animation is complete, switch the class back to closed.
      modal.classList.remove('open');
      modal.classList.add('closed');
      // (Optional) Remove any inline styles GSAP set.
      gsap.set(modal, { clearProps: "all" });

      // Re-enable page scroll
      document.body.style.overflow = '';
    }
  });

  // Remove this event listener so it wonâ€™t be added multiple times.
  modal.removeEventListener('click', closeModal);
}

